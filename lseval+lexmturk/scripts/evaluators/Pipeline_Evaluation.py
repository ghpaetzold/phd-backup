from tabulate import tabulate
import os
from lexenstein.evaluators import *

#Generators:
generators = os.listdir('../../substitutions/')
generators = ['wordnet', 'biran', 'yamamoto', 'glavas', 'kauchak', 'paetzold']
#generators = ['paetzold']
#generators = ['kauchak']
#generators = ['biran']

#Selectors:
selectors = ['void', 'biran', 'wordvector']

#Rankers:
methods = set(os.listdir('../../rankings/'))
#methods.remove('wiki00')

#Selector name map:
namem = {}
namem['lesk'] = 'Lesk'
namem['first'] = 'First'
namem['path'] = 'Path'
namem['biran'] = 'Biran'
namem['clusters'] = 'Belder'
namem['nunes'] = 'Nunes'
namem['svmrank'] = 'SVM Ranking'
#namem['boundaryUnsupervised'] = 'Unsupervised Boundary Ranking RAW'
#namem['boundaryUnsupervisedCV'] = 'Unsupervised Boundary Ranking'
namem['wordvector'] = "Paetzold"
namem['void'] = 'Void'

#Generator name map:
genmap = {}
genmap['merriam'] = 'the Merriam generator'
genmap['yamamoto'] = 'the Yamamoto generator'
genmap['wordnet'] = 'the WordNet generator'
genmap['biran'] = 'the Biran generator'
genmap['kauchak'] = 'the Kauchak generator'
genmap['glavas'] = 'the Glavas generator'
genmap['paetzold'] = 'the Paetzold generator'
genmap['all'] = 'all generators combined'

#Ranker names:
srnamem = {}
srnamem['biran'] = 'Biran Ranker'
srnamem['bott'] = 'Bott Ranker'
srnamem['boundaryCV'] = 'Boundary Ranker'
srnamem['glavas'] = 'Glavas Ranker'
srnamem['kauchak'] = 'SVM Ranker'
srnamem['yamamoto'] = 'Yamamoto Ranker'
srnamem['brown00'] = 'Frequency: Brown'
srnamem['simplewiki00'] = 'Frequency: Simple Wiki'
srnamem['subimdb00'] = 'Frequency: SubIMDB'
srnamem['subtlex00'] = 'Frequency: SUBTLEX'
srnamem['senses'] = 'Senses'
srnamem['synonyms'] = 'Synonyms'
srnamem['hypernyms'] = 'Hypernyms'
srnamem['hyponyms'] = 'Hyponyms'
srnamem['length'] = 'Word Length'
srnamem['syllable'] = 'Syllable Count'
srnamem['devlin'] = 'Devlin'

#Order:
rankorder = ['devlin', 'length', 'syllable', 'senses', 'synonyms', 'hypernyms', 'hyponyms', 'simplewiki00', 'brown00', 'subtlex00', 'subimdb00']
rankorder.extend(['biran', 'bott', 'yamamoto', 'kauchak', 'glavas', 'boundaryCV'])

results = {}
for generator in generators:
	results[generator] = {}
	for selector in selectors:
		results[generator][selector] = {}
		for method in methods:
			results[generator][selector][method] = (-1.0, -1.0, -1.0)

pe = PipelineEvaluator()
for method in methods:
		#print(method)
		files = os.listdir('../../rankings/'+method+'/')

		for file in files:
			filed = file.strip().split('.')[0].strip().split('_')
			generator = filed[1].strip()
			selector = filed[2].strip()

			subs = []
			f = open('../../rankings/'+method+'/'+file)
			for line in f:
				subs.append(line.strip().split('\t'))
			f.close()
			
			try:
				precision, accuracy, changed = pe.evaluatePipeline('../../corpora/ls_dataset_benchmarking.txt', subs)
				
				try:
					if accuracy>results[generator][selector][method][0]:
						results[generator][selector][method] = (precision, accuracy, changed)
						print('Foi!!!!!!!!!!!!!!!!')
				except Exception:
					pass
			except Exception:
				pass

index = -1
for generator in results.keys():
	genprefix = generator[0].upper() + generator[1:len(generator)]
	for selector in results[generator].keys():
		index += 1
		myt = ''
		myt += r'\begin{table}[htpb]'+'\n'
		myt += r'\caption{Evaluation results for SR approaches with respect to substitutions generated by ' + genmap[generator]
		myt += ', as selected by the '
		myt += namem[selector] + r' Selector}' + '\n'		
		myt += r'\centering'+'\n'
		myt += r'\label{table:benchsr'+str(index)+'}\n'
		myt += r'\begin{tabular}{l|ccc}'+'\n'
		myt += r'Ranker & Precision & Accuracy & Changed Proportion \\'+ '\n'
		myt += r'\hline'+'\n'
		for method in rankorder:
			if method in results[generator][selector]:
				methodp = srnamem[method]
				myt += methodp + ' '
				data = results[generator][selector][method]
				for comp in data:
					cstr = "%.3f" % comp
					if len(cstr)==1:
						cstr += '.000'
					elif len(cstr)==3:
						cstr += '00'
					elif len(cstr)==4:
						cstr += '0'
					myt += r'& $' + cstr + r'$ '
				myt += r'\\' + '\n'
		myt += r'\end{tabular}'+'\n'
		myt += r'\end{table}'+'\n'
		myt += r'\pagebreak'+'\n'
		print(myt)
